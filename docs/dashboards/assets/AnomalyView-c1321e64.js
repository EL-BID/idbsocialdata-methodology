import{_ as P,r as V,b as _,o as f,c as g,g as a,h as l,i as y,a as e,F as O,d as N,t as d,j as h,m as w,f as U,e as z}from"./index-738f42de.js";d3plus.colorDefaults.missing="white";d3plus.colorDefaults.scale.range(["#305EA9","#1C97C9","#6CCDEF","#685990","#B1B6BA","#555555","#24264F","#30A98C","#F453AA","#F9965E","#FC4D4D","#FFCB65"]);d3plus.formatDefaultLocale="es-ES";const q={setup(){var S=V(!1),C=V(""),E=V([]),n=[];n=["Shock externo","Cambio de metodología","Otros"];var j=async()=>{const r=await Promise.all([fetch("https://mydata.iadb.org/resource/s8uc-zq8r.json").then(s=>s.ok&&s.json()||Promise.reject(s)),fetch("https://mydata.iadb.org/resource/mjbx-2muu.json").then(s=>s.ok&&s.json()||Promise.reject(s))]).then(s=>{var i=s[0],b=s[1],x=i.sort((o,c)=>o.isoalpha3<c.isoalpha3?-1:o.isoalpha3>c.isoalpha3?1:0),v=[];return x.forEach(o=>{var c=v.filter(m=>o.indicator==m.indicator&&o.isoalpha3==m.isoalpha3)[0];c!=null?(c.years.push(+o.year),c.years=[...new Set(c.years.map(m=>+m))]):(o.years=[+o.year],v.push(o))}),v.forEach(o=>{o.exception=null,o.years_exception=[];var c=b.filter(m=>m.isoalpha3==o.isoalpha3&&m.indicator==o.indicator)[0];c!=null&&(o.years_exception.push(c.year),o.exception=c)}),console.log(v),v});E.value=r},A=()=>{fetch("https://mydata.iadb.org/resource/mjbx-2muu.json",{method:"POST",headers:{Authorization:"OAuth ZeJLaxe-dvTgkOxd5CsyOAg7PoylMDL2mYnB","Content-Type":"application/json"},body:JSON.stringify({id:"1233",indicator:"prangoedad0_15",year:"2015",isoalpha3:"SLV",anomalyconfirmed:"1",comments:"Value is within expected range"})}).then(r=>r.json()).then(r=>{console.log(r)})},k=r=>{fetch(`https://mydata.iadb.org/resource/q8e9-eb82.json?$$app_token=IjHG1z0fQXsM9vxlkB8vPq3S2&indicator=${r.indicator}&isoalpha3=${r.isoalpha3}&totals_dummy=1`).then(s=>s.json()).then(s=>{d3.select("#viz").select("svg").remove(),console.clear(),d3.max(s,i=>i.value),new d3plus.LinePlot().data(s).groupBy(["isoalpha3","indicator"]).height(600).x(i=>+i.year).loadingMessage(!0).tooltip(!0).lineMarkerConfig({fill:(i,b)=>+i.y&&y(r.years).indexOf(i.x)>-1||i.value&&y(r.years).indexOf(+i.year)>-1?"#C24E4C":"#1E88E5",label:i=>d3.format(".2f")(i.y),r:20,labelConfig:{fontResize:!0}}).baseline(0).title(`Error encontrado en: <b>${r.isoalpha3} ${r.years.join(", ")} ${r.indicator} ${r.theme_en}</b>`).tooltip(!0).lineMarkers(!0).legend(!1).y(i=>+i.value).select("#viz").render()})};return{getData:j,anomalies:E,dialog:S,drawViz:k,addException:A,describe_exception:n,indicatorNameToSearch:C}},created(){},async mounted(){this.getData()}},F={class:"container"},L=e("p",{class:"text-3xl font-semibold mb-2 lg:mb-0"},"REPORTE DE ANOMALÍAS EN LOS INDICADORES",-1),M=e("p",{class:"text-md mb-2 lg:mb-0"},[h(" Se identifican las anomalías o valores extremos encontrados en los indicadores socioeconómicos a lo largo del tiempo. Una anomalía se define como aquel valor que se encuentra fuera de tres veces el rango intercuartílico. A continuación, se muestra la distribución de las anomalías por tema, año, indicador y país. Para conocer mayor detalle sobre la metodología de cálculo, visitar el repositorio en GitHub. "),e("ul",{class:"list-disc pl-5"},[e("li",null,"En tendencia, se muestra gráficamente los valores del indicador y se resalta en rojo los números fuera de los rangos esperados."),e("li",null,"En excepción, el technical steward podrá mandar un correo para indicar si el valor está en el rango esperado y debería considerarse como correcto."),e("li",null,"En comentario, se podrá ver aquellos indicadores que a pesar de ser anomalías tienen una explicación para estar tres veces fuera del rango intercuartílico.")])],-1),I=e("p",{class:"text-md mb-2 lg:mb-0"},[h("Las anomalías se pueden descargar desde "),e("a",{class:"text-blue-400",href:"https://mydata.iadb.org/resource/s8uc-zq8r.csv",target:"_blank"},"aquí")],-1),R=e("thead",null,[e("tr",null,[e("th",{class:"bg-blue-darken-1 border border-slate-300 p-1 font-weight-black"}," ID "),e("th",{class:"bg-blue-darken-1 border border-slate-300 p-1 font-weight-black"}," País "),e("th",{class:"bg-blue-darken-1 border border-slate-300 p-1 font-weight-black"}," Tema "),e("th",{class:"bg-blue-darken-1 border border-slate-300 p-1 font-weight-black"}," Indicador "),e("th",{class:"bg-blue-darken-1 border border-slate-300 p-1 font-weight-black"}," Año "),e("th",{class:"bg-blue-darken-1 border border-slate-300 p-1 font-weight-black"}," Acciones ")])],-1),$=e("div",{id:"viz"},null,-1),G=e("div",null,null,-1),H={class:"v-card-text"},J=e("hr",null,null,-1),Q=e("p",{class:"pt-5"},[h("Si desea agregar una excepción para anomaía seleccionada, debe enviar un email a "),e("b",null,"scldata@iadb.org"),h(" con el siguiente formato.")],-1),X=e("br",null,null,-1),Y=e("b",{class:"text-blue-400"},"Asunto del email: ",-1),Z=e("br",null,null,-1),K=e("b",{class:"pt-10 text-blue-400"},"Contenido del email",-1),W=e("br",null,null,-1),ee=e("b",{class:"pt-2"},"Indicador: ",-1),te=e("br",null,null,-1),ae=e("b",{class:"pt-2"},"País: ",-1),oe=e("br",null,null,-1),le=e("b",{class:"pt-2"},"Año/s: ",-1),ne=e("br",null,null,-1),re=e("b",{class:"pt-2"},"Motivo general: ",-1),se=e("br",null,null,-1),ie=e("b",{class:"pt-2"},"Comentario: ",-1),ce={class:"d-flex align-center flex-column"},de={class:"v-card-text"};function ue(S,C,E,n,j,A){const k=_("v-col"),r=_("v-row"),s=_("v-text-field"),i=_("v-chip"),b=_("v-btn"),x=_("v-spacer"),v=_("v-card-actions"),o=_("v-card"),c=_("v-dialog"),m=_("v-select"),T=_("v-textarea"),D=_("v-table");return f(),g("div",F,[a(r,{class:""},{default:l(()=>[a(k,null,{default:l(()=>[L,M,I]),_:1})]),_:1}),a(r,null,{default:l(()=>[a(k,null,{default:l(()=>[a(s,{modelValue:n.indicatorNameToSearch,"onUpdate:modelValue":C[0]||(C[0]=t=>n.indicatorNameToSearch=t),label:"Búsqueda por identificador de indicador, tema, país o año",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),a(D,{density:"compact",class:"mt-10"},{default:l(()=>[R,e("tbody",null,[(f(!0),g(O,null,N(n.indicatorNameToSearch!=""?n.anomalies.filter(t=>t.years.join(",").toUpperCase().indexOf(n.indicatorNameToSearch.toUpperCase())>-1||t.isoalpha3.toUpperCase().indexOf(n.indicatorNameToSearch.toUpperCase())>-1||t.indicator.toUpperCase().indexOf(n.indicatorNameToSearch.toUpperCase())>-1||t.theme_en.toUpperCase().indexOf(n.indicatorNameToSearch.toUpperCase())>-1):n.anomalies,(t,B)=>(f(),g("tr",{key:t.id},[e("td",null,d(B+1),1),e("td",null,d(t.isoalpha3),1),e("td",null,d(t.theme_en),1),e("td",null,d(t.indicator),1),e("td",null,[(f(!0),g(O,null,N(t.years,(u,p)=>(f(),g("div",{class:"inline",key:p},[a(i,{size:"x-small",color:t.years_exception.indexOf(u.toString())!=-1?"success":"black"},{default:l(()=>[h(d(u),1)]),_:2},1032,["color"])]))),128))]),e("td",null,[e("div",null,[a(c,{fullscreen:""},{activator:l(({props:u})=>[a(b,w({variant:"outlined",size:"x-small"},u,{text:"Tendencia",onClick:p=>n.drawViz(t)}),null,16,["onClick"])]),default:l(({isActive:u})=>[a(o,{title:""},{default:l(()=>[$,G,a(v,null,{default:l(()=>[a(x),a(b,{text:"Cerrar",onClick:p=>u.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(c,null,{activator:l(({props:u})=>[a(b,w({variant:"outlined",size:"x-small"},u,{text:"➕ excepción",class:"ml-2",onClick:p=>n.addException(t)}),null,16,["onClick"])]),default:l(({isActive:u})=>[a(o,{title:"Envio de excepción para una anomalía"},{default:l(()=>[e("div",H,[a(m,{multiple:"",class:"w-25 d-inline-block pr-10 pt-5",label:"Año de la excepción",modelValue:t.year_exception,"onUpdate:modelValue":p=>t.year_exception=p,items:t.years,variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"]),n.describe_exception?(f(),U(m,{key:0,class:"w-25 d-inline-block",label:"Motivo de la excepción",modelValue:t.describe_exception,"onUpdate:modelValue":p=>t.describe_exception=p,items:n.describe_exception,variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])):z("",!0),a(T,{maxlength:"500",placeholder:"Explicación de la excepción",rows:"3",variant:"outlined",class:"pt-2",modelValue:t.comments,"onUpdate:modelValue":p=>t.comments=p},null,8,["modelValue","onUpdate:modelValue"]),J,Q,X,Y,e("p",null,[h("Excepción para "),e("b",null,d(t.indicator)+" / "+d(t.isoalpha3)+" / "+d(t.year_exception?t.year_exception.join(","):t.year),1)]),Z,K,W,ee,h(d(t.indicator),1),te,ae,h(d(t.isoalpha3),1),oe,le,h(d(t.year_exception?t.year_exception.join(","):t.year),1),ne,re,h(d(t.describe_exception),1),se,ie,h(d(t.comments),1)]),a(v,null,{default:l(()=>[a(x),a(b,{text:"Cerrar",onClick:p=>u.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024),a(c,null,{activator:l(({props:u})=>[t.exception!=null?(f(),U(b,w({key:0,variant:"outlined",color:"success",size:"x-small"},u,{text:"Comentario",class:"ml-2 border-1",onClick:p=>n.addException(t)}),null,16,["onClick"])):z("",!0)]),default:l(({isActive:u})=>[e("div",ce,[a(o,{title:"Motivo de excepción",width:"400"},{default:l(()=>[e("div",de,[e("h3",null,d(t.exception.year),1),e("p",null,d(t.exception.comments),1)]),a(v,null,{default:l(()=>[a(x),a(b,{text:"Cerrar",onClick:p=>u.value=!1},null,8,["onClick"])]),_:2},1024)]),_:2},1024)])]),_:2},1024)])])]))),128))])]),_:1})])}const _e=P(q,[["render",ue]]);export{_e as default};
